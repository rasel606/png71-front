{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{usePopup}from\"../../layouts/PopupManager\";import TurnoverCard from\"./TurnoverCard\";import TurnoverDetailPopup from\"./TurnoverDetailPopup\";import TabNavigation from\"./TabNavigation\";import{useApp}from\"../../../contexts/AppContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TurnoverPage=_ref=>{let{showError,showSuccess,showWarning,showInfo}=_ref;const{openPopup,closePopup}=usePopup();const{turnoverData,fetchActiveTurnover,fetchCompletedTurnover,fetchAllTurnoverData}=useApp();const[activeTab,setActiveTab]=useState(\"active\");const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const tabs=[{key:\"active\",label:\"Active\"},{key:\"completed\",label:\"Completed\"}];// Fetch data based on active tab\nconst fetchTabData=async tabKey=>{try{setLoading(true);setError(null);if(tabKey===\"active\"){await fetchActiveTurnover();}else if(tabKey===\"completed\"){await fetchCompletedTurnover();}}catch(err){console.error(\"Error fetching \".concat(tabKey,\" turnover:\"),err);setError(\"Failed to load \".concat(tabKey,\" turnover data\"));showError(\"Failed to load \".concat(tabKey,\" turnover data\"));}finally{setLoading(false);}};// Initial data load\nuseEffect(()=>{fetchAllTurnoverData().finally(()=>{setLoading(false);});},[fetchAllTurnoverData]);const handleTabChange=async tabKey=>{setActiveTab(tabKey);// Fetch data for the new tab if not already loaded\nif(tabKey===\"active\"&&turnoverData.active.length===0||tabKey===\"completed\"&&turnoverData.completed.length===0){await fetchTabData(tabKey);}};const handleDetailClick=turnover=>{openPopup(/*#__PURE__*/_jsx(TurnoverDetailPopup,{turnover:turnover,onClose:closePopup}),{title:\"Turnover Details\",size:\"medium\",position:\"center\",closeOnBackdrop:true,closeOnEscape:true});};const handleRetry=()=>{fetchTabData(activeTab);};// Get filtered data based on active tab\nconst filteredData=activeTab===\"completed\"?turnoverData.completed:turnoverData.active;if(loading&&turnoverData.active.length===0&&turnoverData.completed.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"turnover-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u09B2\\u09CB\\u09A1 \\u09B9\\u099A\\u09CD\\u099B\\u09C7...\"})]});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"turnover-error\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"error-icon\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRetry,className:\"retry-button\",children:\"Retry\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"turnover-page\",children:[/*#__PURE__*/_jsx(TabNavigation,{tabs:tabs,activeTab:activeTab,onTabChange:handleTabChange}),loading&&(turnoverData.active.length>0||turnoverData.completed.length>0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"tab-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner small\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"turnover-content\",children:[/*#__PURE__*/_jsx(\"ul\",{className:\"ticket-wrap\",children:filteredData.length>0?filteredData.map(turnover=>/*#__PURE__*/_jsx(TurnoverCard,{turnover:turnover,onDetailClick:handleDetailClick},turnover.id)):/*#__PURE__*/_jsx(\"div\",{className:\"no-data\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"No \",activeTab,\" turnover records found\"]})})}),filteredData.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"prompt\",children:\"\\uFF0Dend of page\\uFF0D\"})]})]});};export default TurnoverPage;","map":{"version":3,"names":["React","useState","useEffect","usePopup","TurnoverCard","TurnoverDetailPopup","TabNavigation","useApp","jsx","_jsx","jsxs","_jsxs","TurnoverPage","_ref","showError","showSuccess","showWarning","showInfo","openPopup","closePopup","turnoverData","fetchActiveTurnover","fetchCompletedTurnover","fetchAllTurnoverData","activeTab","setActiveTab","loading","setLoading","error","setError","tabs","key","label","fetchTabData","tabKey","err","console","concat","finally","handleTabChange","active","length","completed","handleDetailClick","turnover","onClose","title","size","position","closeOnBackdrop","closeOnEscape","handleRetry","filteredData","className","children","onClick","onTabChange","map","onDetailClick","id"],"sources":["F:/png71/my-app/src/components/member/Turnover/TurnoverPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { usePopup } from \"../../layouts/PopupManager\";\r\n\r\nimport TurnoverCard from \"./TurnoverCard\";\r\nimport TurnoverDetailPopup from \"./TurnoverDetailPopup\";\r\nimport TabNavigation from \"./TabNavigation\";\r\nimport { useApp } from \"../../../contexts/AppContext\";\r\n\r\nconst TurnoverPage = ({ showError, showSuccess, showWarning, showInfo }) => {\r\n  const { openPopup, closePopup } = usePopup();\r\n  const { \r\n    turnoverData, \r\n    fetchActiveTurnover, \r\n    fetchCompletedTurnover,\r\n    fetchAllTurnoverData \r\n  } = useApp();\r\n  \r\n  const [activeTab, setActiveTab] = useState(\"active\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  const tabs = [\r\n    { key: \"active\", label: \"Active\" },\r\n    { key: \"completed\", label: \"Completed\" },\r\n  ];\r\n\r\n  // Fetch data based on active tab\r\n  const fetchTabData = async (tabKey) => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      if (tabKey === \"active\") {\r\n        await fetchActiveTurnover();\r\n      } else if (tabKey === \"completed\") {\r\n        await fetchCompletedTurnover();\r\n      }\r\n    } catch (err) {\r\n      console.error(`Error fetching ${tabKey} turnover:`, err);\r\n      setError(`Failed to load ${tabKey} turnover data`);\r\n      showError(`Failed to load ${tabKey} turnover data`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Initial data load\r\n  useEffect(() => {\r\n    fetchAllTurnoverData().finally(() => {\r\n      setLoading(false);\r\n    });\r\n  }, [fetchAllTurnoverData]);\r\n\r\n  const handleTabChange = async (tabKey) => {\r\n    setActiveTab(tabKey);\r\n    \r\n    // Fetch data for the new tab if not already loaded\r\n    if ((tabKey === \"active\" && turnoverData.active.length === 0) || \r\n        (tabKey === \"completed\" && turnoverData.completed.length === 0)) {\r\n      await fetchTabData(tabKey);\r\n    }\r\n  };\r\n\r\n  const handleDetailClick = (turnover) => {\r\n    openPopup(\r\n      <TurnoverDetailPopup turnover={turnover} onClose={closePopup} />,\r\n      {\r\n        title: \"Turnover Details\",\r\n        size: \"medium\",\r\n        position: \"center\",\r\n        closeOnBackdrop: true,\r\n        closeOnEscape: true,\r\n      }\r\n    );\r\n  };\r\n\r\n  const handleRetry = () => {\r\n    fetchTabData(activeTab);\r\n  };\r\n\r\n  // Get filtered data based on active tab\r\n  const filteredData = activeTab === \"completed\" \r\n    ? turnoverData.completed \r\n    : turnoverData.active;\r\n\r\n  if (loading && turnoverData.active.length === 0 && turnoverData.completed.length === 0) {\r\n    return (\r\n      <div className=\"turnover-loading\">\r\n        <div className=\"loading-spinner\"></div>\r\n        <p>লোড হচ্ছে...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"turnover-error\">\r\n        <div className=\"error-icon\">⚠️</div>\r\n        <p>{error}</p>\r\n        <button onClick={handleRetry} className=\"retry-button\">\r\n          Retry\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"turnover-page\">\r\n      {/* Tab Navigation */}\r\n      <TabNavigation\r\n        tabs={tabs}\r\n        activeTab={activeTab}\r\n        onTabChange={handleTabChange}\r\n      />\r\n\r\n      {/* Loading state for tab switch */}\r\n      {loading && (turnoverData.active.length > 0 || turnoverData.completed.length > 0) && (\r\n        <div className=\"tab-loading\">\r\n          <div className=\"loading-spinner small\"></div>\r\n          <p>Loading...</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Turnover List */}\r\n      <div className=\"turnover-content\">\r\n        <ul className=\"ticket-wrap\">\r\n          {filteredData.length > 0 ? (\r\n            filteredData.map((turnover) => (\r\n              <TurnoverCard\r\n                key={turnover.id}\r\n                turnover={turnover}\r\n                onDetailClick={handleDetailClick}\r\n              />\r\n            ))\r\n          ) : (\r\n            <div className=\"no-data\">\r\n              <p>No {activeTab} turnover records found</p>\r\n            </div>\r\n          )}\r\n        </ul>\r\n\r\n        {filteredData.length > 0 && (\r\n          <div className=\"prompt\">－end of page－</div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TurnoverPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}