{"ast":null,"code":"// context/AuthContext.js\nimport React,{createContext,useContext,useState,useEffect}from'react';import{authService}from'../services/authServices';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[isLoading,setIsLoading]=useState(true);const[token,setToken]=useState(localStorage.getItem('png71-user'));useEffect(()=>{// Initialize the auth service with token\nconst initAuth=async()=>{if(token){console.log(\"Initializing with token:\",token);authService.setToken(token);await fetchUserProfile();}else{setIsLoading(false);}};initAuth();},[token]);const fetchUserProfile=async()=>{try{console.log(\"Fetching user profile...\");const userData=await authService.getProfile();console.log(\"User profile fetched:\",userData);setUser(userData);}catch(error){console.error('Failed to fetch user profile:',error);// Don't logout immediately, might be a temporary server issue\nif(error.message.includes('401')||error.message.includes('Token')){logout();// Only logout on authentication errors\n}}finally{setIsLoading(false);}};const login=async function(userId,password){let language=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'en';try{var _response$data;setIsLoading(true);const response=await authService.login({userId:userId,password,language});console.log(\"Login response:\",response.user);// Handle different response structures\nconst newToken=response.token||((_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.token);const userData=response.user||response.data||response;if(newToken){setToken(newToken);localStorage.setItem('png71-user',newToken);authService.setToken(newToken);}setUser(userData);return response;}catch(error){console.error(\"Login error:\",error);throw new Error(error.message||'Login failed');}finally{setIsLoading(false);}};const logout=()=>{setToken(null);setUser(null);localStorage.removeItem('png71-user');authService.setToken(null);};const value={user,token,isLoading,login,logout,isAuthenticated:!!user&&!!token,setUser};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","authService","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","isLoading","setIsLoading","token","setToken","localStorage","getItem","initAuth","console","log","fetchUserProfile","userData","getProfile","error","message","includes","logout","login","userId","password","language","arguments","length","undefined","_response$data","response","newToken","data","setItem","removeItem","value","isAuthenticated","Provider"],"sources":["F:/png71/my-app/src/contexts/AuthContext.jsx"],"sourcesContent":["\r\n\r\n// context/AuthContext.js\r\nimport React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { authService } from '../services/authServices';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [token, setToken] = useState(localStorage.getItem('png71-user'));\r\n\r\n  useEffect(() => {\r\n    // Initialize the auth service with token\r\n    const initAuth = async () => {\r\n      if (token) {\r\n        console.log(\"Initializing with token:\", token);\r\n        authService.setToken(token);\r\n        await fetchUserProfile();\r\n      } else {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    \r\n    initAuth();\r\n  }, [token]);\r\n\r\n  const fetchUserProfile = async () => {\r\n    try {\r\n      console.log(\"Fetching user profile...\");\r\n      const userData = await authService.getProfile();\r\n      console.log(\"User profile fetched:\", userData);\r\n      setUser(userData);\r\n    } catch (error) {\r\n      console.error('Failed to fetch user profile:', error);\r\n      // Don't logout immediately, might be a temporary server issue\r\n      if (error.message.includes('401') || error.message.includes('Token')) {\r\n        logout(); // Only logout on authentication errors\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (userId, password, language = 'en') => {\r\n    try {\r\n      setIsLoading(true);\r\n      const response = await authService.login({userId: userId, password, language});\r\n      \r\n      console.log(\"Login response:\", response.user);\r\n      \r\n      // Handle different response structures\r\n      const newToken = response.token || response.data?.token;\r\n      const userData = response.user || response.data || response;\r\n      \r\n      if (newToken) {\r\n        setToken(newToken);\r\n        localStorage.setItem('png71-user', newToken);\r\n        authService.setToken(newToken);\r\n      }\r\n      \r\n      setUser(userData);\r\n      \r\n      return response;\r\n    } catch (error) {\r\n      console.error(\"Login error:\", error);\r\n      throw new Error(error.message || 'Login failed');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    setToken(null);\r\n    setUser(null);\r\n    localStorage.removeItem('png71-user');\r\n    authService.setToken(null);\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    token,\r\n    isLoading,\r\n    login,\r\n    logout,\r\n    isAuthenticated: !!user && !!token,\r\n    setUser\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}